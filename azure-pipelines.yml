trigger:
- master

pool:
  vmImage: 'macOS-10.15'

steps:
- bash: echo "##vso[task.prependpath]$CONDA/bin"
  displayName: Add conda to PATH
- bash: sudo chown -R $USER $CONDA
  displayName: Take ownership of conda installation
- script: conda env create -f environment.yml
  displayName: Create Anaconda Environment
- script: conda env list
  displayName:  Environment Installation Verification
- task: Bash@3
  inputs:
    targetType: 'inline'
    script: |
      eval "$(conda shell.bash hook)"
      conda activate amsimp
      conda env list
  displayName: Activate Environment
- bash: |
    python3.7 setup.py install
    python3.7 -c "import amsimp; state = amsimp.Dynamics(ai=False, forecast_length=6); state.simulate()"
  displayName: Install AMSIMP
